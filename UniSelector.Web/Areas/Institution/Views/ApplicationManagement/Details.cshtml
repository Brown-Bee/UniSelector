@model Application

<div class="container" style="margin-top: 6rem;">
    <div class="card shadow">
        <div class="card-header bg-secondary bg-gradient py-3">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="text-white mb-0">Application Details</h3>
                <span class="badge bg-@(Model.Response == "Pending" ? "warning" :
                               Model.Response == "Accepted" ? "success" : "danger") fs-5">
                    @Model.Response
                </span>
            </div>
        </div>

        <div class="card-body p-4">
            <!-- University and Program Info -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="info-card">
                        <h5 class="border-bottom pb-2 mb-3">University Information</h5>
                        <div class="d-flex flex-column gap-2">
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">University:</span>
                                <span class="fw-medium">@Model.University?.Name</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">Faculty:</span>
                                <span class="fw-medium">@Model.Faculty?.StandardFaculty?.CombinedName</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">Major:</span>
                                <span class="fw-medium">@Model.Major?.StandardMajor?.CombinedName</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="info-card">
                        <h5 class="border-bottom pb-2 mb-3">Application Status</h5>
                        <div class="d-flex flex-column gap-2">
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">Submission Date:</span>
                                <span class="fw-medium">@Model.ApplicationDate.ToString("dd/MM/yyyy")</span>
                            </div>
                            @if (!string.IsNullOrEmpty(Model.UniversityFeedback))
                            {
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Feedback:</span>
                                    <span class="fw-medium">@Model.UniversityFeedback</span>
                                </div>
                            }
                            @if (User.IsInRole("Institution"))
                            {
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Student:</span>
                                    <span class="fw-medium">@Model.User?.Name</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Grade:</span>
                                    <span class="fw-medium">@Model.User?.Grade%</span>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
            <!-- Personal Information -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="info-card">
                        <h5 class="border-bottom pb-2 mb-3">Personal Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="d-flex flex-column gap-2">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Full Name:</span>
                                        <span class="fw-medium">@Model.User?.Name</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Civil ID:</span>
                                        <span class="fw-medium">@Model.User?.CivilID</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Gender:</span>
                                        <span class="fw-medium">@Model.User?.Gender</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Birth Date:</span>
                                        <span class="fw-medium">@(Model.User?.BirthDate?.ToString("dd/MM/yyyy"))</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex flex-column gap-2">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Nationality:</span>
                                        <span class="fw-medium">@Model.User?.Nationality</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Mother's Nationality:</span>
                                        <span class="fw-medium">@Model.User?.MothersNationality</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Address:</span>
                                        <span class="fw-medium">@Model.User?.Address</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Academic Information -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="info-card">
                        <h5 class="border-bottom pb-2 mb-3">Academic Background</h5>
                        <div class="d-flex flex-column gap-2">
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">High School Path:</span>
                                <span class="fw-medium">@Model.User?.HighSchoolType</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">Grade:</span>
                                <span class="fw-medium">@Model.User?.Grade%</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">Graduation Year:</span>
                                <span class="fw-medium">@Model.User?.HighSchoolGraduationYear</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">School Type:</span>
                                <span class="fw-medium">@((bool)Model.User?.IsPublicSchool ? "Public" : "Private")</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="info-card">
                        <h5 class="border-bottom pb-2 mb-3">Test Scores & Requirements</h5>
                        <div class="d-flex flex-column gap-2">
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">IELTS Score:</span>
                                <span class="fw-medium @(Model.User?.IELTS >= Model.Major?.MinimumIELTS ? "text-success" : "text-danger")">
                                    @Model.User?.IELTS / @Model.Major?.MinimumIELTS
                                </span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">TOEFL Score:</span>
                                <span class="fw-medium @(Model.User?.TOEFL >= Model.Major?.MinimumTOEFL ? "text-success" : "text-danger")">
                                    @Model.User?.TOEFL / @Model.Major?.MinimumTOEFL
                                </span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">Aptitude Test:</span>
                                <span class="fw-medium @(Model.User?.HasAptitudeTest == Model.Major?.RequiresAptitudeTest ? "text-success" : "text-danger")">
                                    @((bool)Model.User?.HasAptitudeTest ? "Yes" : "No") / @((bool)Model.Major?.RequiresAptitudeTest ? "Required" : "Not Required")
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Program Details -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="info-card">
                        <h5 class="border-bottom pb-2 mb-3">Program Details</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="d-flex flex-column gap-2">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Credits Required:</span>
                                        <span class="fw-medium">@Model.Major?.Credits</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Study Duration:</span>
                                        <span class="fw-medium">@Model.Major?.StandardMajor?.StudyDuration years</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Average Price:</span>
                                        <span class="fw-medium">@Model.Major?.AveragePrice KWD</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex flex-column gap-2">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Average Starting Salary:</span>
                                        <span class="fw-medium">@Model.Major?.AverageStartingSalary KWD</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Required HS Path:</span>
                                        <span class="fw-medium">@Model.Major?.StandardMajor?.HighSchoolPath</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documents Section -->
            <div class="documents-section mb-4">
                <h5 class="border-bottom pb-2 mb-3">Documents</h5>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="document-card">
                            <div class="document-icon">
                                <i class="bi bi-person-vcard"></i>
                            </div>
                            <div class="document-info">
                                <h6>Civil ID</h6>
                                @if (!string.IsNullOrEmpty(Model.CivilIdPath))
                                {
                                    <div class="document-actions">
                                        <a href="@Model.CivilIdPath" target="_blank" class="btn btn-sm btn-primary">
                                            <i class="bi bi-eye"></i> View
                                        </a>
                                    </div>
                                }
                                else
                                {
                                    <span class="text-muted">Not uploaded</span>
                                }
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="document-card">
                            <div class="document-icon">
                                <i class="bi bi-passport"></i>
                            </div>
                            <div class="document-info">
                                <h6>Passport</h6>
                                @if (!string.IsNullOrEmpty(Model.PassportPath))
                                {
                                    <div class="document-actions">
                                        <a href="@Model.PassportPath" target="_blank" class="btn btn-sm btn-primary">
                                            <i class="bi bi-eye"></i> View
                                        </a>
                                    </div>
                                }
                                else
                                {
                                    <span class="text-muted">Not uploaded</span>
                                }
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="document-card">
                            <div class="document-icon">
                                <i class="bi bi-file-earmark-text"></i>
                            </div>
                            <div class="document-info">
                                <h6>High School Certificate</h6>
                                @if (!string.IsNullOrEmpty(Model.HighSchoolCertificatePath))
                                {
                                    <div class="document-actions">
                                        <a href="@Model.HighSchoolCertificatePath" target="_blank" class="btn btn-sm btn-primary">
                                            <i class="bi bi-eye"></i> View
                                        </a>
                                    </div>
                                }
                                else
                                {
                                    <span class="text-muted">Not uploaded</span>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex justify-content-center gap-3">
                @if (User.IsInRole("Institution"))
                {
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Back
                    </a>
                    @if (Model.Response == "Pending")
                    {
                        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#responseModal">
                            <i class="bi bi-check-circle"></i> Respond
                        </button>
                    }
                }
                else
                {
                    <a asp-area="User" asp-controller="Application" asp-action="MyApplications" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Back
                    </a>
                    @if (Model.Response == "Pending")
                    {
                        <button type="button" class="btn btn-danger" onclick="confirmCancel(@Model.Id)">
                            <i class="bi bi-x-circle"></i> Cancel Application
                        </button>
                    }
                }
            </div>
        </div>
    </div>
</div>

<!-- Response Modal for Institution -->
@if (User.IsInRole("Institution") && Model.Response == "Pending")
{
    <div class="modal fade" id="responseModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" asp-action="UpdateStatus">
                    <input type="hidden" name="id" value="@Model.Id" />
                    <div class="modal-header">
                        <h5 class="modal-title">Application Response</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Feedback (Optional)</label>
                            <textarea name="feedback" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" name="status" value="Accepted" class="btn btn-success">Accept</button>
                        <button type="submit" name="status" value="Rejected" class="btn btn-danger">Reject</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}
<form id="deleteForm" method="post" asp-area="Institution" 
      asp-controller="ApplicationManagement" asp-action="Delete">
    <input type="hidden" name="id" id="applicationId" />
</form>

@section Styles {
    <style>
        .info-card {
            padding: 1.25rem;
            background-color: #f8f9fa;
            border-radius: 0.5rem;
            height: 100%;
        }

        .document-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 0.5rem;
            height: 100%;
        }

        .document-icon {
            font-size: 2rem;
            color: #0d6efd;
        }

        .document-info {
            flex: 1;
        }

            .document-info h6 {
                margin-bottom: 0.5rem;
            }

        .document-actions {
            margin-top: 0.5rem;
        }

        .badge {
            padding: 0.5em 1em;
        }
    </style>
}


@section Scripts {
    <script>
        function confirmCancel(id) 
        {
            Swal.fire({
                title: 'Cancel Application',
                text: 'Are you sure you want to cancel this application?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, cancel it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $('#applicationId').val(id);
                    $('#deleteForm').submit();
                }
            });
        }
    </script>
}